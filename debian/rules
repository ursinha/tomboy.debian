#!/usr/bin/make -f

export MONO_SHARED_DIR=$(CURDIR)

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/class/gnome.mk

MAKEFILE = $(firstword $(MAKEFILE_LIST))
DEBIAN_DIR = $(dir $(MAKEFILE))
DEB_SOURCE_NAME = $(shell dpkg-parsechangelog -l$(DEBIAN_DIR)/changelog | grep ^Source | cut -d" " -f2)
DEB_VERSION = $(shell dpkg-parsechangelog -l$(DEBIAN_DIR)/changelog | grep ^Version | cut -d" " -f2)   
VERSION = $(shell echo $(DEB_VERSION) | cut -d"-" -f1 | sed 's/+dfsg.*//')

LDFLAGS+=-Wl,-z,defs -Wl,-O1 -Wl,--as-needed
DEB_CONFIGURE_EXTRA_FLAGS := --disable-scrollkeeper
DEB_INSTALL_DOCS_ALL := README NEWS
DEB_CONFIGURE_EXTRA_FLAGS += --with-mono-addins=system GMCS=/usr/bin/csc

common-configure-indep::
	mkdir -p $(MONO_SHARED_DIR)/.wapi

install/tomboy::
	mkdir -p debian/tomboy/usr/share/pixmaps
	uudecode debian/tomboy-16.xpm.uu && mv tomboy-16.xpm debian/tomboy/usr/share/pixmaps
	uudecode debian/tomboy-32.xpm.uu && mv tomboy-32.xpm debian/tomboy/usr/share/pixmaps
	mkdir -p debian/tomboy/usr/lib/tomboy/addins
	cp debian/PrintNotes.dll.config debian/tomboy/usr/lib/tomboy/addins
	rm -rf debian/tomboy/usr/lib/tomboy/libprintnotes.la
	rm -rf debian/tomboy/usr/lib/tomboy/libtomboy.la

common-binary-predeb-arch::
	dh_clifixperms
	dh_clideps -d

clean::
	rm -rf $(MONO_SHARED_DIR)/.wapi

get-orig-source:
	uscan \
		--package $(DEB_SOURCE_NAME) \
		--watchfile $(DEBIAN_DIR)/watch \
		--upstream-version $(VERSION) \
		--download-version $(VERSION) \
		--destdir . \
		--force-download \
		--rename \
		--repack
